<script src="/env.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script src="/supabaseClient.js"></script>
<script>
  document.getElementById("status").innerText = "Checking session...";

  supabase.auth.onAuthStateChange((event, session) => {
    if (session) {
      localStorage.setItem("user_id", session.user.id);
      document.getElementById("status").innerText = "Login successful! Redirecting...";
      window.location.href = "/dashboard.html";
    } else {
      document.getElementById("status").innerText = "Authentication failed. Please try logging in again.";
    }
  });

  // Fallback in case the above doesn't fire
  supabase.auth.getSession().then(({ data: { session } }) => {
    if (session) {
      localStorage.setItem("user_id", session.user.id);
      document.getElementById("status").innerText = "Login successful! Redirecting...";
      window.location.href = "/dashboard.html";
    }
  });
</script>
